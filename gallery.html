<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bear Family â€“ Photo Albums</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header">
    <nav class="nav container">
      <a class="brand" href="gallery.html">Bear Family</a>
      <ul class="nav-menu">
        <li><button id="logoutBtn" class="btn btn--small btn--ghost">Logout</button></li>
      </ul>
    </nav>
  </header>

  <main class="container section">
    <h1>ğŸ“¸ Photo Albums</h1>
    <p class="muted" style="margin-bottom: 2rem;">Your albums from Google Drive folders</p>
    
    <div id="loadingMessage" style="text-align:center; padding:3rem;">
      <p class="muted">â³ Loading albums from Google Drive...</p>
    </div>

    <div id="albumsGrid" class="grid"></div>
  </main>

  <script src="app.js"></script>
  <script>
    (async function(){
      await FamilyApp.requireAuth();

      const albumsGrid = document.getElementById('albumsGrid');
      const loadingMessage = document.getElementById('loadingMessage');

      // Logout handler
      document.getElementById('logoutBtn').addEventListener('click', () => {
        FamilyApp.logout();
        location.href = 'index.html';
      });

      // Load albums from Google Drive
      try {
        const albums = await FamilyApp.fetchAlbumsFromDrive();
        
        loadingMessage.style.display = 'none';

        if (albums.length === 0) {
          albumsGrid.innerHTML = `
            <div style="grid-column: 1/-1; text-align:center; padding:3rem; max-width:600px; margin:0 auto;">
              <h2>ğŸ“ No Albums Found</h2>
              <p class="muted" style="margin:1rem 0;">Create folders in your Google Drive to organize photos into albums.</p>
              
              <div style="background:#1a1d2e; padding:1.5rem; border-radius:8px; margin-top:2rem; text-align:left;">
                <strong style="color:#4f7cff;">Expected Structure:</strong>
                <pre style="color:#e9eef6; margin-top:1rem; line-height:1.8;">
ğŸ“ Bear Family Photos
   â”œâ”€â”€ ğŸ“ Italy
   â”‚   â”œâ”€â”€ rome.jpg
   â”‚   â””â”€â”€ venice.jpg
   â”œâ”€â”€ ğŸ“ Summer
   â”‚   â””â”€â”€ beach.jpg
   â””â”€â”€ ğŸ“ Christmas
       â””â”€â”€ tree.jpg</pre>
              </div>

              <p class="muted" style="margin-top:2rem;">
                <strong>Your folder:</strong><br>
                <a href="https://drive.google.com/drive/folders/1skx93vYn0OE9u-64snbnds8DaOHQGu3G" 
                   target="_blank" 
                   style="color:#4f7cff;">
                  Open in Google Drive â†’
                </a>
              </p>
            </div>
          `;
          return;
        }

        // Render album cards
        albums.forEach(album => {
          const card = document.createElement('div');
          card.className = 'album-card';
          
          // Use cover photo or placeholder
          const coverImage = album.coverUrl 
            ? `<img src="${album.coverUrl}" alt="${album.title}">`
            : `<div style="height:180px; background:linear-gradient(135deg, #11131a 0%, #0d0f16 100%); display:flex; align-items:center; justify-content:center; color:#4f7cff; font-size:3rem;">ğŸ“</div>`;
          
          card.innerHTML = `
            ${coverImage}
            <div class="pad">
              <h3 style="margin:0 0 0.5rem 0;">${album.title}</h3>
              <p class="kicker">Click to view photos</p>
            </div>
          `;

          // Click to view album
          card.style.cursor = 'pointer';
          card.addEventListener('click', () => {
            window.location.href = `album.html?id=${encodeURIComponent(album.id)}&name=${encodeURIComponent(album.title)}`;
          });

          albumsGrid.appendChild(card);
        });

        console.log(`âœ… Displayed ${albums.length} albums`);

      } catch (error) {
        loadingMessage.style.display = 'none';
        
        // Check if it's the folder sharing error
        if (error.message.includes('FOLDER_NOT_SHARED')) {
          albumsGrid.innerHTML = `
            <div style="grid-column: 1/-1; text-align:center; padding:3rem; max-width:700px; margin:0 auto;">
              <h2 style="color:#ff8c8c;">ğŸ”’ Folder Not Shared</h2>
              <p style="margin:1.5rem 0; font-size:1.1rem;">
                Your Google Drive folder must be <strong>publicly shared</strong> to display photos.
              </p>

              <div style="background:#1a1d2e; padding:2rem; border-radius:12px; margin-top:2rem; text-align:left;">
                <strong style="color:#4f7cff; font-size:1.1rem;">ğŸ“‹ How to Fix:</strong>
                
                <ol style="margin:1.5rem 0; line-height:2; color:#e9eef6;">
                  <li>Open your folder: 
                    <a href="https://drive.google.com/drive/folders/1skx93vYn0OE9u-64snbnds8DaOHQGu3G" 
                       target="_blank" 
                       style="color:#4f7cff;">
                      Click here â†’
                    </a>
                  </li>
                  <li>Right-click the folder â†’ Click <strong>"Share"</strong></li>
                  <li>Under "General access", click <strong>"Change"</strong></li>
                  <li>Select: <strong>"Anyone with the link"</strong></li>
                  <li>Set permission to: <strong>"Viewer"</strong></li>
                  <li>Click <strong>"Done"</strong></li>
                  <li><strong style="color:#25c2a0;">IMPORTANT:</strong> Do this for <strong>EACH subfolder</strong> too (Italy, Summer, etc.)</li>
                </ol>

                <div style="background:#0d0f16; padding:1rem; border-radius:8px; margin-top:1.5rem; border-left:3px solid #25c2a0;">
                  <p style="margin:0; color:#25c2a0; font-weight:600;">âœ… After sharing:</p>
                  <p style="margin:0.5rem 0 0 0; color:#a9b0c0;">Wait 30 seconds, then refresh this page.</p>
                </div>
              </div>

              <button class="btn" onclick="location.reload()" style="margin-top:2rem;">
                ğŸ”„ Refresh Page
              </button>
            </div>
          `;
        } else {
          // Other errors
          albumsGrid.innerHTML = `
            <div style="grid-column: 1/-1; text-align:center; padding:3rem;">
              <h2 style="color:#ff8c8c;">âŒ Error Loading Albums</h2>
              <p class="muted">${error.message}</p>
              <p class="muted" style="margin-top:1rem;">Check browser console (F12) for details</p>
            </div>
          `;
        }
        
        console.error('Error loading albums:', error);
      }
    }());
  </script>
</body>
</html>
