<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bear Family ‚Äì Photo Albums</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header">
    <nav class="nav container">
      <a class="brand" href="gallery.html">Bear Family</a>
      <ul class="nav-menu">
        <li><button id="logoutBtn" class="btn btn--small btn--ghost">Logout</button></li>
      </ul>
    </nav>
  </header>

  <main class="container section">
    <h1>üì∏ Photo Albums</h1>
    <p class="muted" style="margin-bottom: 2rem;">Each folder in your Google Drive is an album</p>
    
    <div id="loadingMessage" style="text-align:center; padding:3rem;">
      <p class="muted">Loading albums from Google Drive...</p>
    </div>

    <div id="albumsGrid" class="grid"></div>
  </main>

  <script src="app.js"></script>
  <script>
    (async function(){
      await FamilyApp.requireAuth();

      const albumsGrid = document.getElementById('albumsGrid');
      const loadingMessage = document.getElementById('loadingMessage');

      // Logout handler
      document.getElementById('logoutBtn').addEventListener('click', () => {
        FamilyApp.logout();
        location.href = 'index.html';
      });

      // Load albums from Google Drive
      try {
        const albums = await FamilyApp.fetchAlbumsFromDrive();
        
        loadingMessage.style.display = 'none';

        if (albums.length === 0) {
          albumsGrid.innerHTML = `
            <div style="grid-column: 1/-1; text-align:center; padding:3rem;">
              <h2>No Albums Found</h2>
              <p class="muted">Create folders in your Google Drive to organize photos into albums.</p>
              <p class="muted">Folder ID: 1skx93vYn0OE9u-64snbnds8DaOHQGu3G</p>
            </div>
          `;
          return;
        }

        // Render album cards
        albums.forEach(album => {
          const card = document.createElement('div');
          card.className = 'album-card';
          
          // Use cover photo or placeholder
          const coverImage = album.coverUrl 
            ? `<img src="${album.coverUrl}" alt="${album.title}">`
            : `<div style="height:180px; background:linear-gradient(135deg, #11131a 0%, #0d0f16 100%); display:flex; align-items:center; justify-content:center; color:#4f7cff; font-size:3rem;">üìÅ</div>`;
          
          card.innerHTML = `
            ${coverImage}
            <div class="pad">
              <h3 style="margin:0 0 0.5rem 0;">${album.title}</h3>
              <p class="kicker">Click to view photos</p>
            </div>
          `;

          // Click to view album
          card.style.cursor = 'pointer';
          card.addEventListener('click', () => {
            window.location.href = `album.html?id=${encodeURIComponent(album.id)}&name=${encodeURIComponent(album.title)}`;
          });

          albumsGrid.appendChild(card);
        });

        console.log(`‚úÖ Displayed ${albums.length} albums`);

      } catch (error) {
        loadingMessage.innerHTML = `
          <p style="color:#ff8c8c;">‚ùå Error loading albums: ${error.message}</p>
          <p class="muted">Check browser console for details</p>
        `;
        console.error('Error loading albums:', error);
      }
    }());
  </script>
</body>
</html>
